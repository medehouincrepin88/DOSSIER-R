) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
flextable()
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table()
mod_traitement<-lm(intention ~ traitement-1, Fusion_feuille)
mod_traitement<-lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
View(Fusion_feuille)
Fusion_feuille %>% names()
Feuille1 = Feuille1 %>%
mutate( traitement = sample(c(0,1), size = nrow(Feuille1), replace = TRUE))
Feuille1 %>%
head() %>%
flextable()
Feuille2 <- read_excel("Base_Partie 2.xlsx",
sheet = "district")
Fusion_feuille = left_join(Feuille1,Feuille2, by = "district")
View(Fusion_feuille)
attach(Fusion_feuille)
#----------------------------------------------------------------------------------------
# Convertir les colonnes "starttime" et "endtime" en objets de type POSIXct
# pour pouvoir effectuer des calculs de durée :
#---------------------------------------------------------------------------------------
starttime <- as.POSIXct(starttime)
endtime <- as.POSIXct(endtime)
Fusion_feuille %>% names()
# Calculer la durée de l'entretien en soustrayant la colonne "starttime" de la colonne "endtime"
Fusion_feuille %>%
mutate(duree =difftime(endtime, starttime, units = "mins")) %>%
group_by(enumerator) %>%
summarise(duree_moyenne = mean(duree, na.rm = TRUE)) %>%
flextable()
#--------------------------------------------------------------------------------------
# Définissez le préfixe pour les nouvelles colonnes
#--------------------------------------------------------------------------------------
prefixe <- "endline_"
#----------------------------------------------------------------------------------------
# Renommez les colonnes en ajoutant le préfixe
#-----------------------------------------------------------------------------------------
noms_nouveaux <- lapply(names(Fusion_feuille), function(col)
paste0(prefixe, col))
names(Fusion_feuille) <- unlist(noms_nouveaux)
Fusion_feuille %>%
names()
#--------------------------------------------------------------------------------
#  Renommos les observations de la variable sexe
#--------------------------------------------------------------------------------
Fusion_feuille_test <- Fusion_feuille %>%
dplyr::mutate(endline_sex = ifelse(endline_sex == "0", "homme", "femme"))
#-------------------------------------------------------------------------------------
# la fonction tbl_summary comme dans la premiere partie avec un filtre de l'age #999
#-------------------------------------------------------------------------------------
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table()
#------------------------------------------------------------------------------------
# Nuage de point et droit de regression par sexe
#------------------------------------------------------------------------------------
Nuage = Fusion_feuille_test %>%
filter(endline_age != 999)
ggplot(Nuage,aes( x = endline_children_num , y = endline_age,col= endline_sex )) +
geom_jitter(aes(shape = endline_sex),size = 2)+
geom_smooth(method = "lm", se = FALSE)+
labs(x="Nombre d'enfant", y = "Age", title = "Nuage de point")+
labs( col = "Sexe", shape = "Sexe") +
theme_minimal()+
theme(plot.title = element_text(color = "black", size = 16, face = "bold", hjust = 0.5 ))
mod_traitement<-lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
Effet <- coef(mod_traitement)["endline_traitement"]
mod <- summary(mod_traitement)
bind_rows(
broom::tidy(mod))%>%
kbl() %>%
kable_paper(full_width = TRUE)
bind_rows(
broom::tidy(mod))%>%
kbl()
bind_rows(
broom::tidy(mod))
modele <- summary(mod_traitement)
bind_rows(
broom::tidy(modele))
bind_rows(
broom::tidy(modele)) %>%
flextable()
library(kableExtra)
library(kableExtra)
mod_traitement<-lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
mod_A <- lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
mod_B <- lm(endline_intention ~ endline_traitement -1 + endline_age + endline_age, Fusion_feuille )
mod_C <- lm(endline_intention ~ endline_traitement -1 + endline_age + endline_age + district, Fusion_feuille)
tableau_regression <- bind_rows(
broom::tidy(mod_A) ,
broom::tidy(mod_B) ,
broom::tidy(mod_C)
)%>%
mutate(
estimate = round(estimate, 3),
std.error = round(std.error, 3),
statistic = round(statistic, 3),
p.value = round(p.value, 3)
)
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8) %>%
kable_styling() %>%
column_spec(1, bold = TRUE) %>%
column_spec(5, color = c(tableau_regression$p_value_color))
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8) %>%
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8)
tableau_regression <- bind_rows(
broom::tidy(mod_A) ,
broom::tidy(mod_B) ,
broom::tidy(mod_C)
)%>%
mutate(
estimate = round(estimate, 3),
std.error = round(std.error, 3),
statistic = round(statistic, 3),
p.value = round(p.value, 3)
)
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8)
tableau_regression %>%
kbl()
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE)
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8)
library(gtsummary)
library(broom)
# Modèles de régression
mod_traitement <- lm(endline_intention ~ endline_traitement - 1, Fusion_feuille)
mod_A <- lm(endline_intention ~ endline_traitement - 1, Fusion_feuille)
mod_B <- lm(endline_intention ~ endline_traitement - 1 + endline_age + endline_age, Fusion_feuille)
mod_C <- lm(endline_intention ~ endline_traitement - 1 + endline_age + endline_age + district, Fusion_feuille)
mod_A <- lm(endline_intention ~ endline_traitement - 1, Fusion_feuille)
mod_B <- lm(endline_intention ~ endline_traitement - 1 + endline_age + endline_age, Fusion_feuille)
mod_C <- lm(endline_intention ~ endline_traitement - 1 + endline_age + endline_age + district, Fusion_feuille)
mod_traitement<-lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
mod_A <- lm(endline_intention ~ endline_traitement-1, Fusion_feuille)
mod_B <- lm(endline_intention ~ endline_traitement -1 + endline_age + endline_age, Fusion_feuille )
mod_C <- lm(endline_intention ~ endline_traitement -1 + endline_age + endline_age + endline_district, Fusion_feuille)
tableau_regression <- bind_rows(
broom::tidy(mod_A) ,
broom::tidy(mod_B) ,
broom::tidy(mod_C)
)%>%
mutate(
estimate = round(estimate, 3),
std.error = round(std.error, 3),
statistic = round(statistic, 3),
p.value = round(p.value, 3)
)
tableau_regression %>%
kbl() %>%
kable_paper(full_width = TRUE) %>%
group_rows(group_label ="MODELE A", start_row =1, end_row =2) %>%
group_rows(group_label ="MODELE B", start_row =3, end_row =5) %>%
group_rows(group_label ="MODELE C", start_row =6, end_row =8) %>%
kable_styling() %>%
column_spec(1, bold = TRUE) %>%
column_spec(5, color = c(tableau_regression$p_value_color))
modele <- stats::lm(endline_intention ~ endline_traitement, Fusion_feuille)
modele %>%
gtsummary::tbl_regression() %>%
as_flex_table()
modele %>%
gtsummary::tbl_regression(
label = list(endline_traitement ~ "TRAITEMENT")
)
modele %>%
gtsummary::tbl_regression(
label = list(endline_traitement ~ "TRAITEMENT")
)%>%
as_flex_table()
Modele_B = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex) %>%
gtsummary::tbl_regression()
Modele_B = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex) %>%
gtsummary::tbl_regression()
Modele_C = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex+ endline_district) %>%
gtsummary::tbl_regression()
tableau = gtsummary::tbl_stack(
list(modele_A,
modele_B,
modele_C),
group_header = c("MODELE A", "MODELE B", "MODELE C")
) %>%
as_flex_table()
Modele_A = modele %>%
gtsummary::tbl_regression()
Modele_A = modele %>%
gtsummary::tbl_regression()
Modele_A = modele %>%
gtsummary::tbl_regression()
Modele_B = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex) %>%
gtsummary::tbl_regression()
Modele_C = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex+ endline_district) %>%
gtsummary::tbl_regression()
Modele_C = stats::lm(data =Fusion_feuille,  endline_traitement ~ endline_age + endline_sex+ endline_district) %>%
gtsummary::tbl_regression()
tableau = gtsummary::tbl_stack(
list(Modele_A,
Modele_B,
Modele_C),
group_header = c("MODELE A", "MODELE B", "MODELE C")
) %>%
as_flex_table()
gtsummary::tbl_stack(
list(Modele_A,
Modele_B,
Modele_C),
group_header = c("MODELE A", "MODELE B", "MODELE C")
) %>%
as_flex_table()
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table() %>%
fontsize(size = 8) %>%
width(width = 1)
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table() %>%
fontsize(size = 8)
library(flextable)
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table() %>%
fontsize(size = 8)
#--------------------------------------------------------------------------------------
# lecture de la feuille 2 du fichier Excel "Base_Partie 2.xlsx" :IMPORTATION
#--------------------------------------------------------------------------------------
Feuille2 <- read_excel("Base_Partie 2.xlsx",
sheet = "district")
#####################################################################################
#
# ----------- CHARGEMENT DES PACKAGES UTILISES----------------
#
#####################################################################################
# ------------------MANIPULATION DE DONNEES :-----------------------------
library(dplyr)
library(tidyverse)
library(janitor)
# ------------------------VISUILISATION DE DONNEES :--------------------------------
library(ggplot2)
library(viridis)
library(ggnewscale)
library(ggspatial)
library(scales)
library(visdat)
library(ggpirate)#devtools::install_github("mikabr/ggpirate")
#-----------------------TABLEAU ET RESUMES DE DONNEES :-------------------------
library(gt)
library(flextable)
library(gtsummary)
# ------------------------LECTURE DE DONNEES :-----------------------------
library(readxl)
# ----------------------GESTION DE DONNEES SPATIALES :----------------------
library(tmap)
library(raster)
library(leaflet)
library(sf)
# --------------------GESTION DE DISPOSITION DES GRAPHIQUES :-----------------------
library(gridExtra)
#
#--------------------------------------------------------------------------------------
# lecture du fichier Excel "Base_Partie 1.xlsx" :IMPORTATION
#--------------------------------------------------------------------------------------
projet <- read_excel("Base_Partie 1.xlsx")
#
Feuille1 <- read_excel("Base_Partie 2.xlsx")
Feuille1 <- Feuille1 %>%
rename(destination = country_destination) %>%
mutate(across(everything(), ~ ifelse(. < 0, NA, .)))
Feuille1 %>%
head()
attach(Feuille1)
min(age)
textlab <-c()
largeur <- 5
nbcat <- 9
for( i in 3 : (nbcat - 1 )){
textlab[i+1] <- paste("[",as.character(i*largeur),",",as.character((i+1)*largeur),"[",sep="")}
textlab <- textlab[complete.cases(textlab)]
Feuille1 = Feuille1 %>%
mutate( group_age = cut ( age, breaks = seq(from = 15, to = nbcat*largeur, by = largeur), labels = textlab),.after = age)
Feuille1 %>%
head %>%
gt()
Feuille1 %>%
head()
View(Feuille1)
#-------------------------------------------------------------------------------------------
# La fonction count pour compter le nombre de repetition de la variable enumerator et l'ajouter a la variable nombre_entretien
#-------------------------------------------------------------------------------------------
Entretien = Feuille1 %>%
count(enumerator, sort = TRUE , name = "nombre_entretien")
Entretien %>%
flextable()
Entretien = Feuille1 %>%
count(enumerator, sort = TRUE , name = "nombre_entretien")
Entretien %>%
as_flex_table()
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table() %>%
fontsize(size = 8) %>%
width(width = 1.3)
Fusion_feuille_test %>%
filter(endline_age != 999) %>%
tbl_summary(
include = c("endline_age","endline_sex"),
by = endline_sex,
statistic = endline_age ~ " {mean} [{sd}]",
label = endline_age ~ "AGE",
digits = list(endline_age ~ 0)
) %>%
add_difference() %>%
add_overall(
last = TRUE
) %>%
bold_labels() %>%
italicize_levels() %>%
modify_header(update = list( label ~ "**Variable**",
all_stat_cols(stat_0 = FALSE) ~ "_{level}_ (n={n}, {style_percent(p)}%)",
stat_0 ~ "**TOTAL** (n={N})",
p.value ~ "**Test de comparaison** (p-valeur)"
)) %>%
bold_labels() %>%
italicize_levels() %>%
modify_spanning_header(
all_stat_cols(stat_0 = FALSE) ~ "**SEXE**"
) %>%
as_flex_table() %>%
fontsize(size = 8) %>%
width(width = 1)
